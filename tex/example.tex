%================================================================================
%
\section{Example}
\label{sec:example}

An example will now be presented to demonstrate the utility of the developed MILP charge scheduling techique. A
description of the scenario is first presented followed a description of an alternative heuristic based planning
strategy called Quin-Modified which is used as a comparison to the MILP PAP. Results are then presented for each of
planning strategies are presented, analyzed, and discussed.

%--------------------------------------------------------------------------------
%
\subsection{BEB Scenario}

% TODO: Review over this again
To display the capabilities of the model, an example scenario is presented. The scenario was run over a time horizon of
$T=24$ hours, utilizes $n_B = \A$ buses with $n_V = \N$ visits to the station divided between the $n_B$ buses. As stated
before, the route times are sampled from a set of routes from the UTA. Each bus has \batsize KWh battery that is
required to stay above \mincharge charge (\fpeval{\batsize * \minchargeD} KWh) to maintain battery health. Each bus is
assumed to begin the working day with \fpeval{\acharge*100}\% charge (\fpeval{\acharge * \batsize} KWh). Additionally,
each bus is required to end the day with a minimum charge of \fpeval{\bcharge * 100}\% (\fpeval{\bcharge * \batsize}
KWh). Each bus is assumed to discharge at a rate of 30 KW. Note that there are many factors that play a factor in the
rate of discharge; however, for the sake of simplicity an average rate is used. $n_C = \fpeval{\fast + \slow}$ chargers
are utilized where \slow of the chargers are slow charging (\slows KW) and \fast are fast charging (\fasts KW). A
technique to minimize chargers will be employed.

To encourage the MILP PAP problem to utilize the fewest number of chargers, the value of $m_q$ in the objective
function, \eqref{eq:objective}, is $\forall q \in n_Q; m_q = 1000q$. The charge duration scalar, $\epsilon_q$, is defined as
$\epsilon_q = r_q$ to create a consumption cost term, $g_{iq}\epsilon_q$. This is utilized to also encourage the model to minimize
active charger times, particuarly for the fast chargers.

Another heuristic-based optimization strategy, referred to as Quin-Modified, is also employed as a means of comparison
with the results of the MILP PAP. The Quin-Modified strategies is a based on the threshold strategy of \cite{Qin2016}.
The strategy has been modified slightly to accommodate the case of multiple charger types and without exhaustive search
for the best charger type. The heuristic is based on a set of rules that revolve around the initial charge of the bus at
visit $i$. There are three different thresholds, low (60\%), medium (75\%), and high (90\%). Buses below the low
threshold are prioritized to fast chargers then are allowed to utilize slow chargers if no fast chargers are available.
Buses between the low and medium threshold prioritize slow chargers first and utilize fast chargers only if no slow
chargers are available. Buses above the medium threshold and below high will only be assigned to slow chargers. Buses
above the high threshold will not be charged. Once a bus has been assigned to a charger, it remains on the charger for
the duration of the time it is at the station, or it reaches 90\% charge, whichever comes first.

\TODO{The schedule is sampled from the Utah Transit Authority (UTA) bus routing data that occurs over a 24-hour time
  period}. The total number of constraints resulted in \contvars continuous and \intvars integer/binary constraints. The
optimization was performed using the Gurobi MILP solver \cite{GurobiOptimization2021} on a machine running an AMD Ryzen
9 5900X 12 - Processor (24 core) at 4.95GHz. The solver was allowed to run for \timeran seconds and did not converge to
the optimal result with a gap \gappercent.

%--------------------------------------------------------------------------------
%
\subsection{Results}

The schedule generated by the Quin-Modified strategy and the MILP PAP is shown in Fig \ref{subfig:quin-schedule} and Fig
\ref{subfig:milp-schedule}, respectively. The x-axis represents the time in hours. The y-axis represents the assigned
charging queue. Points between 0 and \fpeval{\slow - 1} are active times for slow chargers, and points between the range of
\fpeval{\slow - 1} and \fpeval{\fast + \slow - 1} are active times for fast chargers. The unique vertices represents the
starting charge time for a bus $b$ with the line to the vertical tick signifying the region of time the charger is
active. The line connecting points represent the charge sequence for a bus. Each color in Fig \ref{subfig:quin-schedule}
and \ref{subfig:milp-schedule} are used to identify the bus assigned.

The first observation is in the choice of preferred chargers between the Quin-Modified and MILP scheduler. The
Quin-Modified schedule uses at most 4 fast chargers and 3 slow whereas the MILP schedule uses at most 2 fast chargers
and 8 slow, the eighth charger actually being the ninth queue, but that is due to the non-optimal results. Both the
Quin-Modifed and MILP schedule used the fast chargers in short bursts (~0.2-0.5 hours). The main difference lies in the
utilization strategy of the slow chargers. The Quin-Modified, for the most part, opted for shorter bursts for the slow
chargers (~0.3-0.7 hour), most heavily placed on the first slow charger. The MILP also used these shorter charge times
on the first slow charger; however, the schedule was able to recognize the bus routes that had longer durations at the
station and could choose the lower cost option, slow charging, when available and of lower cost. Although one the MILP's
objectives is to minimize the amount of chargers used, the Quin-Modified ended up using 7 chargers while the MILP used
8. The reason for this is the construction of the objective function that is attempting to optimize over the consumption
cost, total number of chargers, and charger type. Hence, the objective function found it more efficient to utilize an
extra slow charger for a longer duration than to add another fast charger for a short duration. Although both schedules
generated are valid, no comparison of the quality the schedule can be made.

Figs \ref{subfig:quin-charge} and \ref{subfig:milp-charge} depicts the charge for every bus over the time horizon. Every
vehicle begins at 90\% charge, finishes at \fpeval{\bcharge *100}\% charge in the MILP PAP schedule, and never goes
below \mincharge in the intermediate arrivals as stated in the constraints \eqref{eq:dynconstrs}. There is no guarantee
for this in the Quin-Modified strategy which can be seen by some of the bus charges reaching negative values and the
distribution of final charges. The only sense of guarantee that the Quin-Modified supplies is its predictability within
the intermediate visits because of the heuristic nature (i.e. if the charge the low threshold, a fast charger will be
prioritized) whereas MILP places a bus in the queue that ``makes sense'' in respect to the larger picture. The MILP PAP
does not have an obvious sense of decision-making due to its weighted decisions that are affected by the accumulation of
decisions made prior.

Another important measure for the chargers is to compare the amount of power and energy consumed. Fig
\ref{fig:power-usage} depicts the power consumption throughout the time horizon. It can easily be seen that the
Quin-Modifed power consumption is steadily less than the MILP schedule. This can be accounted for by the MILP's
constraints to keep the bus charges above \mincharge and to reach the \fpeval{\bcharge *100}\% charge at the end of the
working day. It is also important to note that largest peak for the Quin-Modified schedule verses the lack of any real
peak for the MILP PAP schedule. Although the MILP PAP had firmer constraints than the Quin-Modified algorithm, it
maintained a steady power consumption profile throughout the time horizon. Along a similar vein, the accumulated energy
consumed is shown in Fig \ref{fig:energy-usage}. The MILP schedule is more efficient up until about hour 11. Again, this
can be accounted for by the fact the MILP is accommodating the extra constraints. Even with these constraints, MILP PAP
consumes about $1\cdot10^5$ Kwh more than the Quin-Modified. The overlap of the MILP PAP can be accounted for by Fig
\ref{subfig:fast-charger-usage} and \ref{subfig:slow-charger-usage}. At the $\text{11}^{\text{th}}$ hour, a spike in
slow chargers can be seen in an attempt to keep the bus charges above the \mincharge charge and preparing to meet the
final \fpeval{\bcharge * 100}\% constraint.
